<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Stats | Snoozz - Tab & Window Snoozing</title>
  <meta name="title" content="Snoozz - Tab & Window Snoozing">
  <meta name="description" content="A lightweight, open-source WebExtension to help you manage your tabs better.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://snoozz.me/">
  <meta property="og:title" content="Snoozz - Tab & Window Snoozing">
  <meta property="og:description" content="A lightweight, open-source WebExtension to help you manage your tabs better.">
  <meta property="og:image" content="https://snoozz.me/assets/banner.jpg">
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://snoozz.me/">
  <meta property="twitter:title" content="Snoozz - Tab & Window Snoozing">
  <meta property="twitter:description" content="A lightweight, open-source WebExtension to help you manage your tabs better.">
  <meta property="twitter:image" content="https://snoozz.me/assets/banner.jpg">
  <meta name="author" content="Rohan Bhansali">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="./css/bootstrap.min.css" rel="stylesheet">
  <link href="./css/animate.css" rel="stylesheet">
  <link href="./css/common.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
  <style type="text/css">
    .choice-row {
      padding: .75rem .5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      line-height: 1;
      border-bottom: 1px dashed rgba(0, 0, 0, .1);
    }
    .choice-row.highlight {
      background-color: var(--orange);
    }
    .choice-row:first-child, .choice-row:last-child {
      border: none;
    }
    .color-block {
      padding: 0 .37rem;
      border-radius: .5rem;
      margin-left: 1rem;
    }
    .spinner {
      width: 40px;
      height: 40px;
      transform:perspective(150px) rotateX(0);
      animation: f1-1 2s infinite linear, f1-2 1s infinite linear alternate;
    }
    #breakfast, #dinner {
      transform: rotate(-15deg);
    }
    #AM, #PM, #AM_TEXT, #PM_TEXT, #AM_LABEL, #PM_LABEL {
      transform: rotate(15deg);
    }

    @keyframes f1-1 {
      100% {transform:perspective(150px) rotateX(360deg)}
    }

    @keyframes f1-2 {
      0%,49.9% {background: var(--pink)}
      50%,100% {background: var(--orange)}
    }
  </style>
  <script async defer data-website-id="c03d7b02-81d7-423b-abc0-3627e8cd1577" src="https://stats.rohan.xyz/umami.js"></script>
</head>
<body class="d-flex flex-column">
  <nav class="navbar sticky-top navbar-expand-lg navbar-light bg-transparent">
    <div class="container">
      <a class="navbar-brand umami--click--snoozz-logo-header" href="/">
        <img src="./img/logo.svg" alt="snoozz logo">
      </a>
      <button class="navbar-burger d-block d-lg-none me-2 p-4 collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"></button>
      <div class="collapse navbar-collapse flex-row-reverse" id="navbarNavDropdown">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link umami--click--changelog-header" href="./changelog">Changelog</a>
          </li>
          <li class="nav-item">
            <a class="nav-link umami--click--privacy-header" href="./privacy">Privacy</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active umami--click--stats-header" href="./stats">Stats</a>
          </li>
          <li class="nav-item">
            <a class="nav-link umami--click--github-header" href="https://github.com/rohanb10/snoozz-tab-snoozing">Github</a>
          </li>
        </ul>
        <div class="navbar-stripe"></div>
      </div>
    </div>
  </nav>
  <div class="main-body w-100">
    <div class="container py-lg-5">
      <h1><strong>Analytics</strong></h1>
      <p>Snoozz collects a minimal amount of anonymous data to see which choices and times are being used the most.</p>
      <p>You can read more about whats being collected <a target="_blank" href="https://github.com/rohanb10/snoozz-tab-snoozing/issues/39">on Github</a>. The server used to collect this data is also <a target="_blank" href="https://github.com/rohanb10/snoozz-stats">open source</a>.</p>
      <div class="d-flex justify-content-center">
        <div class="loading my-5 py-5" style="min-height: 70vh;">
          <div class="spinner"></div>
        </div>
      </div>
      <div class="click-data row pt-3 pt-md-5 d-none">
        <div class="col-12 col-md-6 choice-table">
          <div class="header choice-row" style="font-weight: 800;">
            <div style="text-decoration: underline;">Choice</div>
            <div class="d-flex">
              <span>Count</span>
              <div class="color-block">&nbsp;</div>
            </div>
          </div>
          <div id="startup" class="choice-row">
            <div>On Next Startup</div>
            <div class="d-flex">
              <span class="count">-</span>
              <div class="color-block" style="background-color: #ffff">&nbsp;</div>
            </div>
          </div>
          <div id="in-an-hour" class="choice-row">
            <div>In One Hour</div>
            <div class="d-flex">
              <span class="count">-</span>
              <div class="color-block" style="background-color: #ffff">&nbsp;</div>
            </div>
          </div>
          <div id="today-morning" class="choice-row">
            <div>This Morning</div>
            <div class="d-flex">
              <span class="count">-</span>
              <div class="color-block" style="background-color: #ffff">&nbsp;</div>
            </div>
          </div>
          <div id="today-evening" class="choice-row">
            <div>This Evening</div>
            <div class="d-flex">
              <span class="count">-</span>
              <div class="color-block" style="background-color: #ffff">&nbsp;</div>
            </div>
          </div>
          <div id="tom-morning" class="choice-row">
            <div>Tomorrow Morning</div>
            <div class="d-flex">
              <span class="count">-</span>
              <div class="color-block" style="background-color: #ffff">&nbsp;</div>
            </div>
          </div>
          <div id="tom-evening" class="choice-row">
            <div>Tomorrow Evening</div>
            <div class="d-flex">
              <span class="count">-</span>
              <div class="color-block" style="background-color: #ffff">&nbsp;</div>
            </div>
          </div>
          <div id="weekend" class="choice-row">
            <div>Weekend</div>
            <div class="d-flex">
              <span class="count">-</span>
              <div class="color-block" style="background-color: #ffff">&nbsp;</div>
            </div>
          </div>
          <div id="monday" class="choice-row">
            <div>Next Monday</div>
            <div class="d-flex">
              <span class="count">-</span>
              <div class="color-block" style="background-color: #ffff">&nbsp;</div>
            </div>
          </div>
          <div id="week" class="choice-row">
            <div>Next Week</div>
            <div class="d-flex">
              <span class="count">-</span>
              <div class="color-block" style="background-color: #ffff">&nbsp;</div>
            </div>
          </div>
          <div id="month" class="choice-row">
            <div>Next Month</div>
            <div class="d-flex">
              <span class="count">-</span>
              <div class="color-block" style="background-color: #ffff">&nbsp;</div>
            </div>
          </div>
          <div id="custom" class="choice-row" style="border-bottom-color: #333">
            <div>Choose your own time</div>
            <div class="d-flex">
              <span class="count">-</span>
              <div class="color-block" style="background-color: #ffff">&nbsp;</div>
            </div>
          </div>
          <div id="total" class="choice-row">
            <div><b>Total</b></div>
            <div class="d-flex">
              <span class="count">-</span>
              <div class="color-block" style="background-color: transparent;">&nbsp;</div>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-6 d-flex align-items-center pb-md-3 pb-0">
          <div class="d-flex justify-content-center align-items-center flex-column w-100 my-5">
            <div id="bakery"></div>
          </div>
        </div>
      </div>
      <div class="time-data row pb-5 pb-md-0 d-none justify-content-center">
        <div class="row d-flex justify-content-center">
          <div class="col-md-6 px-0">
            <div id="breakfast" class="text-center"></div>
          </div>
          <div class="col-md-6 px-0">
            <div id="dinner" class="text-center"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="footer-stripe"></div>
  </div>
  <footer class="pt-lg-5 pt-md-4 pt-3 pb-0 mt-auto">
    <div class="row container mx-auto">
      <div class="col-12 col-md">
        <h5>Snoozz</h5>
        <small class="d-block mb-3 text-light">2020-2021</small>
        <h5>Author</h5>
        <ul class="list-unstyled text-small">
          <li><a target="_blank" class="link-light umami--click--rohanxyz-footer" href="https://rohan.xyz/">Rohan Bhansali</a></li>
        </ul>
      </div>
      <div class="col-6 col-md">
        <h5>Support</h5>
        <ul class="list-unstyled text-small">
          <li><a target="_blank" class="link-light umami--click--bugs-footer" href="https://github.com/rohanb10/snoozz-tab-snoozing/issues/new/choose">Report a Bug</a></li>
          <li><a target="_blank" class="link-light umami--click--suggest-footer" href="https://github.com/rohanb10/snoozz-tab-snoozing/issues/new/choose">Suggest a feature</a></li>
          <li><a class="link-light umami--click--compatibility-footer" href="./compatibility">Compatibility</a></li>
          <li><a class="link-light umami--click--faq-footer" href="./faq">FAQ</a></li>
        </ul>
      </div>
      <div class="col-6 col-md">
        <h5>Resources</h5>
        <ul class="list-unstyled text-small">
          <li><a class="link-light umami--click--privacy-footer" href="./privacy">Privacy</a></li>
          <li><a class="link-light umami--click--stats-footer" href="./stats">Stats</a></li>
          <li><a class="link-light umami--click--changelog-footer" href="./changelog">Changelog</a></li>
          <li><a class="link-light umami--click--attribution-footer" href="./attribution">Attribution</a></li>
        </ul>
      </div>
      <div class="col-6 col-md">
        <h5>Links</h5>
        <ul class="list-unstyled text-small">
          <li><a target="_blank" class="link-light umami--click--github-footer" href="https://github.com/rohanb10/snoozz-tab-snoozing">Github</a></li>
          <li><a target="_blank" class="link-light umami--click--cws-footer" href="https://chrome.google.com/webstore/detail/snoozz-snooze-tabs-window/lklendgldejcnkkaldoggoapclkepgfb">Chrome Web Store</a></li>
          <li><a target="_blank" class="link-light umami--click--moz-footer" href="https://addons.mozilla.org/en-US/firefox/addon/snoozz/">Firefox Add-Ons</a></li>
        </ul>
      </div>
    </div>
  </footer>
  <div id="hidden" class="d-none"></div>
  <script src="./js/gradientStep.js"></script>
  <script src="./js/d3_v7.js"></script>
  <script src="./js/bootstrap.min.js"></script>
  <script>
    var CLICK_COLOURS = ['#a6cee3', '#537a5a', '#fada5e', '#d64933', '#58919d', '#cf995f', '#cab2d6', '#1f78b4', '#67cb6f', '#424B54', '#fe938c'];
    Array(Math.floor(Math.random() * CLICK_COLOURS.length)).fill().map(_ => CLICK_COLOURS.push(CLICK_COLOURS.shift())); // shuffle colors in order

    var B_COLOURS = gradientSteps('#F3B845', '#DF4E76', 12);
    var D_COLOURS = gradientSteps('#44CFF2', '#4C3BAA', 12);
    var pack = Math.random() < .5 ? 'animal' : 'human';

    async function loadClicks() {
      var response = await fetch(`https://stats.snoozz.me/clicks`);
      response.json().then(data => {
        buildClickTable(data);
        buildClickChart(data);
        document.querySelector('.loading').classList.add('d-none');
      }); 
    }

    function buildClickTable(data) {
      data.forEach((d, i) => {
        document.querySelector(`#${d.option} .count`).innerText = d.count.toLocaleString();
        document.querySelector(`#${d.option} .color-block`).style.backgroundColor = CLICK_COLOURS[i];
        (new Image()).src = `../icons/${pack}-${d.option}.png`;
      });
      document.querySelector('#total .count').innerText = data.map(d => d.count).reduce((a, b) => a + b).toLocaleString();
      document.querySelector('.click-data').classList.remove('d-none');
    }

    function buildClickChart(data) {
      console.log('click', data);
      var total = data.map(d => d.count).reduce((a, b) => a + b);
      var walls = document.getElementById('bakery').parentElement.getBoundingClientRect();
      walls = walls.width > 400 ? 380 : walls.width - 20;
      var width = walls, height = walls, outer = (walls - 40) / 2, inner = (walls - 160) / 2;

      var arc = d3.arc().outerRadius(outer).innerRadius(inner);
      var higlightedArc= d3.arc().outerRadius(outer + 20).innerRadius(inner);
      var pie = d3.pie().sort(null).value(d => d.count);
      var svg = d3.select('#bakery').append('svg').attr('width', width).attr('height', height).append('g').attr('transform', `translate(${width / 2}, ${height / 2})`);
      var g = svg.selectAll('.arc').data(pie(data)).enter().append('g');
      svg.append('svg:image').attr('id', 'bread').attr('text-anchor', 'middle').attr('x', -32).attr('y', -32).attr('width', 64).attr('height', 64).attr('xlink:href', '../img/logo.svg');
      svg.append('text').attr('id', 'crumbs').attr('text-anchor', 'middle').attr('y', 64).attr('font-size', '1.25em').attr('style', 'display: block').text('');

      g.append('path').attr('d', arc).style('fill', (d, i) => CLICK_COLOURS[i]).on('mouseover', function(e, d) {
        d3.select(this).transition().attr('d', higlightedArc);
        d3.select('#bread').attr('xlink:href', `../icons/${pack}-${d.data.option}.png`);
        d3.select('#crumbs').text(Math.round(d.data.count * 100 / total) + '%');
        document.getElementById(d.data.option).classList.add('highlight');
      }).on('mouseout', function(e, d) {
        d3.select(this).transition().attr('d', arc);
        d3.select('#bread').attr('xlink:href', '../img/logo.svg');
        d3.select('#crumbs').text('');
        document.getElementById(d.data.option).classList.remove('highlight');
      });
      
    }

    async function loadTimes() {
      var response = await fetch(`https://stats.snoozz.me/times`);
      response.json().then(data => {
        buildTimeChart(data.sort((a, b) => parseInt(a.when) - parseInt(b.when)));
        document.querySelector('.loading').classList.add('d-none');
      }); 
    }

    var maxTimeCount = 0;
    function processTimeData(data) {
      // var rand =(min, max) => Math.floor(Math.random() * (max - min + 1) + min);
      // data.forEach(d => d.count = rand (0, 12));
      var good = data.filter((d, i) => i % 2 == 0), bad = data.filter((d, i) => i % 2 == 1);
      bad.forEach((b, i) => {
        good[i].count += Math.ceil(b.count / 2);
        good[i].index = i;
        good[(i + 1) % good.length].count += Math.floor(b.count / 2);
      });
      return good;
    }

    function buildTimeChart(data) {
      console.log('time', data);
      data = processTimeData(data);
      maxTimeCount = Math.max(...data.map(d => d.count));
      buildRadial('breakfast', 'AM', data.slice(0, data.length / 2), B_COLOURS);
      buildRadial('dinner', 'PM', data.slice(-data.length / 2), D_COLOURS);
      document.querySelector('.time-data').classList.remove('d-none');
    }

    function formatTime(s) {
      var h = parseInt(s.substring(0, 2)), m = parseInt(s.substring(2));
      return `${h % 12 == 0 ? 12 : h % 12} ${h > 11 ? 'P' : 'A'}M`;
    }
    function buildRadial(selector, which, data, colours) {
      var width = 400, height = 400, inner = 40, outer = 200;
      data = processTimeData(data);
      var svg = d3.select('#' + selector).append('svg').attr('viewBox', `0 0 ${height} ${width}`).append('g').attr('transform', `translate(${width/2}, ${height/2})`);

      var x = d3.scaleBand().range([0, 2 * Math.PI]).align(0).domain(data.map(d => d.when));
      var y = d3.scaleRadial().range([inner, outer]).domain([0, maxTimeCount + 250]);

      var donut = d3.arc().innerRadius(inner).outerRadius(d => y(d.count + 1)).startAngle(d => x(d.when)).endAngle(d => x(d.when) + x.bandwidth())
      svg.append('g').selectAll('path').data(data).join('path').attr('fill', (d, i) => colours[i]).attr('d', donut).on('mouseover', (e, d) => {
        d3.select('#' + which + '_TEXT').text((d.count).toLocaleString()).attr('style', 'display: block');
        d3.select('#' + which).attr('style', 'display: none');
      }).on('mouseout', _ => {
        d3.select('#' + which + '_TEXT').text('').attr('style', 'display: none');
        d3.select('#' + which).attr('style', 'display: block');
      });
      svg.append('text').attr('id', which + '_TEXT').attr('text-anchor', 'middle').attr('y', 6).attr('font-size', '1em').attr('style', 'display: block').text('');

      // data = data.filter((d, i) => i % 2 == 0);
      svg.append('g').selectAll('g').data(data).join('g')
        .attr('text-anchor', d => (x(d.when) + x.bandwidth() / 2 + Math.PI) % (2 * Math.PI) < Math.PI ? 'end' : 'start')
        .attr('transform', (d, i) => `rotate(${((x(d.when) + x.bandwidth() / 2) * 180 / Math.PI - 90)}) translate(${y(d.count) + 4}, 0)`)
        .append('text').text(d => formatTime(d.when))
        .attr('transform', d => (x(d.when) + x.bandwidth() / 2 + Math.PI) % (2 * Math.PI) < Math.PI ? 'rotate(180)' : 'rotate(0)')
        .style('font-size', '11px').attr('alignment-baseline', 'middle');

      // svg.append('text').attr('id', which).attr('text-anchor', 'middle').attr('y', 12).attr('font-size', '2em').text(which);
      svg.append('svg:image')
      .attr('id', which)
      .attr('text-anchor', 'middle')
      .attr('x', -18)
      .attr('y', -18)
      .attr('width', 36)
      .attr('height', 36)
      .attr('xlink:href', `../icons/${which == 'AM' ? 'animal' : 'human'}-nap-room.png`);
    }

    loadClicks();
    loadTimes();
  </script>
</body>
</html>